# .maestro/sub-flows/sign-in.yaml
# Sign in with configurable credentials.
#
# Parameters (passed via env):
#   EMAIL    - User email address
#   PASSWORD - User password
#
# Handles both states:
#   - App on welcome screen → taps sign-in link first
#   - App already on login screen → proceeds directly
#
# Usage:
#   - runFlow:
#       file: sub-flows/sign-in.yaml
#       env:
#         EMAIL: "e2e-primary@test.local"
#         PASSWORD: "E2eTestPassword123!"

appId: com.sps.fitchallenge
---
# If on welcome screen, tap sign-in link (optional — may already be on login)
- tapOn:
    id: "welcome-sign-in-link"
    optional: true

# Wait for login screen
- assertVisible:
    id: "login-screen"

# Clear and enter email
- tapOn:
    id: "email-input"
- eraseText
- inputText: ${EMAIL}

# Clear and enter password
- tapOn:
    id: "password-input"
- eraseText
- inputText: ${PASSWORD}

# Dismiss keyboard — tap non-interactive area (docs.maestro.dev workaround for iOS)
- tapOn:
    point: "50%, 10%"

# Tap sign in
- tapOn:
    id: "signin-button"

# iOS shows a "Save Password?" system dialog after sign-in when
# secureTextEntry is used. This is an OS-level behavior that cannot
# be suppressed at the app level (React Native issues #37236, #21911).
# Maestro has no auto-dismiss for this dialog (issue #2089).
#
# extendedWaitUntil waits for the dialog to appear (resolves in ~2s
# when dialog shows, times out harmlessly after 8s if it doesn't).
- extendedWaitUntil:
    visible:
      text: "Not Now"
    timeout: 8000
    optional: true
- tapOn:
    text: "Not Now"
    optional: true

# Wait for home screen
- extendedWaitUntil:
    visible:
      id: "home-screen-v2"
    timeout: 20000
