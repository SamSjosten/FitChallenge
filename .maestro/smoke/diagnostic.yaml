# .maestro/smoke/diagnostic.yaml
# =============================================================================
# DIAGNOSTIC TEST — Validates E2E infrastructure works end-to-end
# =============================================================================
#
# Phase 0: Screenshot what's on screen after launch (debugging)
# Phase 1: Fresh launch → welcome screen reachable
# Phase 2: Sign-in → home screen reachable
# Phase 3: Tab navigation → profile screen reachable, home return
#
# This is the Day 1 gate — if this fails, check the screenshots in artifacts.
# Replaces: e2e/diagnostic.e2e.ts

appId: com.sps.fitchallenge

---
# ===========================================================================
# PHASE 0: Launch and capture what the app is actually showing
# ===========================================================================

- launchApp:
    clearState: true
    clearKeychain: true

# Give the app time to initialize auth, resolve session, and navigate.
# Auth safety timeout is 10s, so we need at least that plus navigation time.
- waitForAnimationToEnd

# Screenshot BEFORE any assertions — if the test fails, this shows what's visible
- takeScreenshot: after-launch

# ===========================================================================
# PHASE 1: Fresh launch — app boots and renders welcome screen
# ===========================================================================

# Use extendedWaitUntil instead of assertVisible — gives the app time
# to complete auth initialization + navigation to welcome screen.
# Auth provider has a 10-second safety timeout, so 30s is generous.
- extendedWaitUntil:
    visible:
      id: "welcome-screen"
    timeout: 30000
    label: "Phase 1: Welcome screen visible after fresh launch"

# ===========================================================================
# PHASE 2: Sign-in — auth flow completes
# ===========================================================================

- tapOn:
    id: "welcome-sign-in-link"
    label: "Phase 2: Tap sign-in link"

- assertVisible:
    id: "login-screen"

- tapOn:
    id: "email-input"
- inputText: "e2e-primary@test.local"

- tapOn:
    id: "password-input"
- inputText: "E2eTestPassword123!"

# Dismiss keyboard — tap non-interactive area (docs.maestro.dev workaround for iOS)
- tapOn:
    point: "50%, 10%"

- tapOn:
    id: "signin-button"

- extendedWaitUntil:
    visible:
      id: "home-screen-v2"
    timeout: 20000
    label: "Phase 2: Home screen visible after sign-in"

- takeScreenshot: after-signin

# ===========================================================================
# PHASE 3: Post-auth interaction — tab navigation works
# ===========================================================================

- tapOn:
    id: "tab-profile"
    label: "Phase 3: Navigate to profile tab"

- assertVisible:
    id: "profile-screen-v2"
    label: "Phase 3: Profile screen visible"

- tapOn:
    id: "tab-home"
    label: "Phase 3: Navigate back to home tab"

- assertVisible:
    id: "home-screen-v2"
    label: "Phase 3: Home screen visible after tab switch"
